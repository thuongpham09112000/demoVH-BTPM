#cloud-config
hostname: ${hostname}
fqdn: ${hostname}.lab.com
package_update: true
package_upgrade: true
packages:
  - python3-pip
users:
  - name: ansible
    groups: sudo
    shell: /bin/bash
    lock_passwd: true
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC/fRnf6Ze+4WwuLDu9UlHVU2W0WxU3tnM0TDVAJNymm0J99qAe8pKdkAI6TTsHHEVfMmJcuxzhIPGUihade/Xozq2nRk7fSIn4haG6a86xuJCx/x8Q9zJ+ZT6hBxTTog8HGpajROfk41lkb/DJf2u+9giUQJJtsWYr767eB34jo+SLkTp+crU/T0AgY5Cd/GlHETum3IyiEx8fbtBjwVNiitDoy6YCbEYO41MBaLis+ojhq4N18O/TRVaIyfONBpuUWMNXQ1Mm973m/NC+UXCLrIyShQRU7Rex5z7yFcBCf+91/Bx6cHS314j8tdMy1XGv74wKnbU5GOxlUlV+mduSfFZsLwkZ3OthyEykay7HjBhPOsiYQy2t1+bF89dBo8hAD8GJ1xmyP//xju8xF/wt1QJcyuqcXpa39+fI8ZHzWrA9oNnxw0nQwwggeg9rmXd43Zo52hQr+in6xIg7x0NXZS/vNWO770relr1eQ6x78GdIBd8bqsgTCCKYmy8EvZsNrgDAtCuzLpGE2RLVwCSHosuGw4G+2TFAOVrQDFxPnJIi9khL2n36bo0aogSzE0QGPlX5RSNvaJMPq4EdW4oxGYdTRIZqyA22Cmcs5Dn5hG1eC6g5G83A1knCYha8YdTmxVRyTUq6TOMarnbCtj8E3h1bE7Se2yDejObnryQ+3w== herman@bobcat.local
write_files:
  - path: /root/ansible/.ssh/id_rsa
    permissions: '0600'
    encoding: b64
    content: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBeHovN0x6WVorWkt5VkZza2U2QmVSSlUvQS94ZEkzaUtEa3B0U3hKV2FtcTE4c0NMCkJHWDZIWlFLYTZiNncwSGw3UlJqQ1pyS0xnekc0MXQxdVhrandTMlJZZmw2OTBiZXBzY0x2b3piZi9XUG5hVGIKaWpnTGJNQWZ1S2pXbk9pVUtFY1NjVWNtQzhOcitEdVpzOCtYR3ZnREpIaVhmOU1CL1FRMlFxUTIvRllOZitlNgovY3l6Ry9qMEo5WU9lZVpnNlg5RlRmeXIvbHRDMGVEVUtGT3A0UURUT29UUWZxV0RyVHVwUm1ObjdzZW9PM3J2CnpTSFRTZ2ZrR2JHNHRwbUNQRUVRdkxRNFVuRDRZbUJpeUFxbWRJWnJReS9QeklyaFM3cjJxUWg4Ri9IMVgyVVgKVFpXOTIvbFkyanR6Zm5tRjVCc1l3ZGU4L0I5aEsxSlNoc0ZYSXdJREFRQUJBb0lCQUYyTzRHNUJ0QjZwVUUwbAo0dEtkOGNXNFlyZUhaMkNCZUNuUHJ0UWlUeXQyNGVxVG1ITS9ReHRpYVNZMWFPZ0lhR05UUUZIQk9oQTNkYWhLClNOUUhXcytaaXZ0N1BzOGZtdXFxNmd2V2JqYitZaW8rdjh0K0YzZEFHMlVFK29rQStKaVZEc2JjQnJSZFZiUmcKb0FKN2hsTm1nMnM3cUwrZm4vNWpYT3NiMnFuUEZZZXFYQi96enB6OVp2aEZKaXVyNnRsMWVJcWl6R0lMSTNVegpGRmNROTVabEdSVHFmeDVublZQTHJIMytMOGszdExzd2tYV3ZmM3dhNkNSUnFmSS9nVXZzYVVXWXdMRVErbHZyCno0M1g0QzhBZUJrY1JrNXNuU3VHa3d0N0U3dDZnVHRPTUJlTWhYN0lBdFE5Qk9qUThPcFMrSzNhRHJLNS9mbW4Kb2pEbCtWa0NnWUVBOVFtTWpDaUw0NzM4cXN4TFUrQnlNbFNEOHlxTzkrczFrKy9MWHFTWEl2a2xyRGNlVUVKTgpnZFEzK2xTR2JGMUhGNzJDVU5FaEZ4aXBTRHdiSjZjR0lnS1ZCNHpwUzhqeEVqOGdSNis0Y2NCcHFtV24yK1Y3Clc3aC80Y0pPWVViMzZXUzV6cnAwSXYwNDNLeW1zanpPeGNaN3YwcHJOOTNUL1FjQ2NxT0R1TFVDZ1lFQTBDb0YKcW1KSkVPb0FpOVEzVDVHa1BxU05YRTJrLytEd0ZHdjdySTFBTStNM2VQU0RUeXZURW5jekppcTN3ZENNTS82RAplZDhObklyY3BjNE14dk94N1UybCtEL0tOTVczRTBLOGdRRmgwZ1E2SERnMmtyQ0JZeFZkNGk0VDdtdnVzNzNICmFqeEs2cW5NSUdhbWlpY24yRjhreVRFZlZQaEpvMnRBVDUrd2IzY0NnWUF6YXVXTEk1YjNHdzdCNkV5R05UckIKUk9yTFE4cnNTdmJiTEI1SXBkRHhEY2JSOUY3d0NIbXJISlVDZW1vYW94Z2Y2eXhGT1J6d2M4UlIzQXIycngyaQpWVmhnVlRrL0pkTXdPUDdWREJKd0RDZ2dFV1MveDgreTEydytPeituT2ZVYmpIOVEyZDgwMkYzdU1HeHFTa2c1ClNBVC9odVlvdXV1WTFMZTJ4b2tGWVFLQmdEbVcxcGhydHBFaVcrSlRaTFh6c2YvT29Ia2YxZjBnYXVzTGNNWXQKRWMwSkdHaXpKTHk3Z0JxRXRiYmliSklITXpLVFFDWndTaUM3M2cxVTh2MzduNGJxUzNkaGxueUJFb1FXbTNZSgpQdG5PWjVFMUVBd0hIdFNkcmFxTVd1RkVKUGEvRXpOVjJOZ1EvN01iRXduM2lUTjRKd0l1UDkvUERQaFVES2U2Cm95SkRBb0dBRVRwTmNnS1VpdnpWdndDV1dOTXRnaWdjT3Z2YnpwRkRjK0FNMTRlbDM4Qm9DRHp2c0h5NVppUmYKcE43SHB2ejlDSVZRT1Z2NnZMaTFTUEd0NEJLc3F3eDh4dW1vME1zSElwc3oxWXhNTGRPOHh1MnBYcnZrSHlUKwpaM0tYYitOWE1qK3dXaVUzTTBnNlJNbGt4UUV0TVFEUEU1cnRxMjF2UzYzWjdLT0ZTWEk9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0t
  - path: /root/ansible/.ssh/id_rsa.pub
    permissions: '0644'
    encoding: b64
    content: c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFCQVFESFAvc3ZOaG41a3JKVVd5UjdvRjVFbFQ4RC9GMGplSW9PU20xTEVsWnFhclh5d0lzRVpmb2RsQXBycHZyRFFlWHRGR01KbXNvdURNYmpXM1c1ZVNQQkxaRmgrWHIzUnQ2bXh3dStqTnQvOVkrZHBOdUtPQXRzd0IrNHFOYWM2SlFvUnhKeFJ5WUx3MnY0TzVteno1Y2ErQU1rZUpkLzB3SDlCRFpDcERiOFZnMS81N3I5ekxNYitQUW4xZzU1NW1EcGYwVk4vS3YrVzBMUjROUW9VNm5oQU5NNmhOQitwWU90TzZsR1kyZnV4Nmc3ZXUvTklkTktCK1Fac2JpMm1ZSThRUkM4dERoU2NQaGlZR0xJQ3FaMGhtdERMOC9NaXVGTHV2YXBDSHdYOGZWZlpSZE5sYjNiK1ZqYU8zTitlWVhrR3hqQjE3ejhIMkVyVWxLR3dWY2ogYW5zaWJsZUBsYWJubXM=
  - path: /root/ansible/ansible.cfg
    permissions: '0644'
    content: |
      [defaults]
      inventory=./hosts
      remote_user=ansible
      private_key_file=~/.ssh/id_rsa
      host_key_checking = False
  - path: /root/ansible/hosts
    permissions: '0644'
    content: |
      [web]
      web[1:3]
      [app]
      app[1:3]
      [db]
      db[1:3]
runcmd:
  - pip3 install ansible
  - cp -r /root/ansible /home && rm -r /root/ansible && chown -R ansible:ansible /home/ansible
power_state:
  mode: reboot
  timeout: 10
  condition: True
